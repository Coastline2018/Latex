% Name           : beamerthemeelegance.sty
% Copyright      : Xinze Zhang (xinze@hust.edu.cn) 2018
%                  Ivan Cukic (ivan at cukic.co) 2016
%                  Benjamin Weiss (benjamin.weiss@student.hs-rm.de) 2013
% Version        : 0.1
% License        : This file may be distributed and/or modified under the
%                  GNU General Public License, version 3 or later
% Description    : Customizable beamer theme

\ProvidesPackage{beamerthemeelegance}[2017/07/01]

\usepackage{eso-pic}
\usepackage{etoolbox}

\usepackage{xcolor}


% \setbeamercovered{transparent=60}

\newif\if@doSans
\@doSansfalse
\DeclareOption{noserifmath}{\@doSanstrue}
\newif\if@doNoFlama
\@doNoFlamafalse
\DeclareOption{noflama}{\@doNoFlamatrue}
\newif\if@doSectionPage
\@doSectionPagefalse
\DeclareOption{nosectionpages}{\@doSectionPagetrue}
\ProcessOptions

\mode<presentation>

%---------------------------------------------------------------------
% TOC
%---------------------------------------------------------------------
\useoutertheme[subsection=false,shadow]{miniframes}
\setbeamertemplate{section in toc}[sections unnumbered]
% \setbeamertemplate{subsection in toc}[subsections unnumbered]
\setbeamertemplate{subsection in toc}{\vspace{.2cm}\inserttocsubsection\\}

%---------------------------------------------------------------------
% Itemize
%---------------------------------------------------------------------
\setbeamertemplate{itemize item}{\textbullet}
\setbeamertemplate{itemize subitem}[circle]
\setbeamertemplate{itemize subsubitem}[circle]

\setlength{\parskip}{0.5em}

%---------------------------------------------------------------------
% Colors
%---------------------------------------------------------------------

% Primary Colors
\definecolor{eleganceRed}{rgb}{0.882352941,0,0.098039216}
\definecolor{eleganceRedDark}{rgb}{0.588235294,0,0.058823529}
\definecolor{eleganceWarmGreyDark}{rgb}{0.274509804,0.254901961,0.235294118}
\definecolor{eleganceWarmGreyLight}{rgb}{0.666666667,0.647058824,0.62745098}
% \definecolor{eleganceWarmGreyLight}{rgb}{1,1,1}

% Secondary Colors
\definecolor{eleganceSec1}{rgb}{0,0.588235294,0.509803922}
\definecolor{eleganceSec1Dark}{rgb}{0,0.392156863,0.31372549}
\definecolor{eleganceSec1Comp}{rgb}{0.294117647,0.745098039,0.882352941}
\definecolor{eleganceSec1CompDark}{rgb}{0.196078431,0.490196078,0.568627451}

\definecolor{eleganceSec2}{rgb}{0.607843137,0.764705882,0.156862745}
\definecolor{eleganceSec2Dark}{rgb}{0.411764706,0.490196078,0.098039216}
\definecolor{eleganceSec2Comp}{rgb}{0.254901961,0.156862745,0.509803922}
\definecolor{eleganceSec2CompDark}{rgb}{0.176470588,0.098039216,0.333333333}

\definecolor{eleganceSec3}{rgb}{0.509803922,0.078431373,0.31372549}
\definecolor{eleganceSec3Dark}{rgb}{0.338345865,0.058823529,0.196078431}
\definecolor{eleganceSec3Comp}{rgb}{1,0.509803922,0}
\definecolor{eleganceSec3CompDark}{rgb}{0.666666667,0.333333333,0}

% General
\setbeamercolor{normal text}{fg=eleganceWarmGreyDark}
\setbeamercolor{structure}{fg=eleganceWarmGreyDark}
\setbeamercolor{alerted text}{fg=eleganceRed}
\setbeamercolor{example text}{fg=white}
\setbeamercolor{copyright text}{fg=eleganceWarmGreyLight}
\setbeamercolor{palette primary}{fg=eleganceWarmGreyDark}
\setbeamercolor{palette secondary}{fg=eleganceWarmGreyDark,bg=white}
\setbeamercolor{palette tertiary}{fg=eleganceWarmGreyDark,bg=white}
\setbeamercolor{palette quaternary}{fg=white,bg=eleganceWarmGreyDark}

% Titlepage
\setbeamercolor{title}{parent=normal text}
\setbeamercolor{subtitle}{parent=normal text}
\setbeamercolor{institute}{parent=normal text}

% Content
\setbeamercolor{frametitle}{parent=palette quaternary}

% Blocks
\setbeamercolor{block title}{parent=palette quaternary}
\setbeamercolor{block body}{parent=palette secondary}
\setbeamercolor{block title example}{fg=white, bg=eleganceSec1Dark}
\setbeamercolor{block body example}{fg=white, bg=eleganceSec1}
\setbeamercolor{block title alerted}{fg=white, bg=eleganceRedDark}
\setbeamercolor{block body alerted}{fg=white, bg=eleganceRed}

% Notes
\setbeamercolor{note page}{fg=eleganceWarmGreyDark,bg=eleganceWarmGreyLight}
\setbeamercolor{note title}{fg=white, bg=eleganceWarmGreyDark}
\setbeamercolor{note date}{parent=note title}

% Page Number
\setbeamercolor{page number in head/foot}{fg=eleganceWarmGreyDark}

\renewcommand\UrlFont{\Medium}
% Titlepage
% \setbeamerfont{title}{family=\Light,size=\fontsize{20}{20}}
% \setbeamerfont{subtitle}{family=\Light,size=\fontsize{12}{14}}
\setbeamerfont{date}{size=\fontsize{8}{10}}
\setbeamerfont{author}{size=\fontsize{12}{15}}
\setbeamerfont{institute}{size=\fontsize{8}{10}}
% Section
\setbeamerfont{section title}{size=\LARGE}
% Content
% \setbeamerfont{frametitle}{family=\Light,size=\large}
% \setbeamerfont{copyright text}{family=\Light,size=\tiny}
\setbeamerfont{block title}{family=\Book,size=\large}
\setbeamerfont{block title alerted}{family=\Book,size=\large}
\setbeamerfont{alerted text}{family=\Medium}
% Captions
\setbeamerfont{caption name}{family=\Book}

%---------------------------------------------------------------------
% Titlepage
%---------------------------------------------------------------------

% Titlepage structure
\def\maketitle{\ifbeamer@inframe\titlepage\else\frame[plain]{
    \titlepage
}\fi}
\def\titlepage{\usebeamertemplate{title page}}
\setbeamertemplate{title page}
{
    % Add background to title page
    \begin{minipage}[b][\paperheight]{\textwidth}
        \vspace*{5mm}
        \includegraphics[height=10mm]{./style/images/hust.png}\par
        \vspace*{5mm}
        \ifx\inserttitle\@empty%
        \else%
            % {\usebeamerfont{title}\usebeamercolor[fg]{title}\MakeUppercase{\inserttitle}\par}%
            {\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par}%
        \fi%
        \ifx\insertsubtitle\@empty%
        \else%
            \begin{flushright}
            {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
            \end{flushright}
            \vspace*{2.5mm}
        \fi%
        \ifx\insertdate\@empty%
        \else%
            \begin{flushright}
            {\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}%
            \end{flushright}
        \fi%

        \vspace*{0.75cm}

        \ifx\insertauthor\@empty%
        \else%
            \begin{flushright}
            {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}%
            \end{flushright}
            \vspace*{10mm}
        \fi%
        \ifx\insertinstitut\@empty%
        \else%
            % \vspace*{5mm}
        %     \begin{flushright}
        %     {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}%
        %     \end{flushright}
        {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}%
        \fi%
        \vspace*{3mm}
    \end{minipage}
}

%---------------------------------------------------------------------
% Sectionpages
%---------------------------------------------------------------------

% Make Sectionhead uppercase
\newcommand{\insertsectionHEAD}{%
    \expandafter\insertsectionHEADaux\insertsectionhead}
    \newcommand{\insertsectionHEADaux}[3]{\MakeUppercase{#3}

    \vspace{1cm}
    \footnotesize
    \tableofcontents[sections=\value{section},sectionstyle=hide/hide]
    \vspace{-4cm}
}

\if@doSectionPage\@empty
\else
% Insert frame with section title at every section start
\AtBeginSection[]
{
\begingroup
\setbeamercolor{background canvas}{bg=mainthemecolour}
\setbeamertemplate{background canvas} {\includegraphics[width=\paperwidth,height=\paperheight]{./style/images/background-section.pdf}}
\begin{frame}[plain]
\centering
\vfill\usebeamerfont{section title}\textcolor{white}{\insertsectionHEAD}\vfill
\end{frame}
\endgroup
}
\fi

%\setbeamertemplate{background canvas} {\includegraphics[width=\paperwidth,height=\paperheight]{./style/images/background-slide.pdf}}

\setbeamertemplate{background canvas}{%
   \ifnumequal{\c@framenumber}{1}{%
       % First frame
       \includegraphics[width=\paperwidth,height=\paperheight]{./style/images/background-title.pdf}
   }{%
       \includegraphics[width=\paperwidth,height=\paperheight]{./style/images/background-slide.pdf}
   }%
}

%---------------------------------------------------------------------
% Frametitle
%---------------------------------------------------------------------
\setbeamertemplate{frametitle}
{
    \begin{beamercolorbox}[wd=\paperwidth,leftskip=0.3cm,rightskip=0.3cm,ht=2.5ex,dp=1.5ex]{}
        % If you remove section titles, you can play with this

        % for the title to be vertically aligned
        % .\\
        % \vspace{-.3cm}
        % \hspace{-0.3cm}\includegraphics[width=\paperwidth,height=1cm]{./style/images/header.png}\\
        % \vspace{-.97cm}
        \usebeamerfont{frametitle}\insertframetitle
    \end{beamercolorbox}
}

%---------------------------------------------------------------------
% Footline
%---------------------------------------------------------------------
\usenavigationsymbolstemplate{}
\setbeamertemplate{footline}
{%
\begin{beamercolorbox}[wd=\textwidth,ht=3ex,dp=1.5ex,leftskip=0.3cm,rightskip=0.3cm]{structure}%
\hfill\usebeamerfont{page number in head/foot}%
\insertframenumber%
\end{beamercolorbox}%
}

%---------------------------------------------------------------------
% Captions
%---------------------------------------------------------------------
\setbeamertemplate{caption label separator}{: }

%---------------------------------------------------------------------
% Blocks
%---------------------------------------------------------------------
\setbeamertemplate{block begin}
{
  \setbeamercolor{item}{parent=block body}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title}
    \usebeamerfont*{block title}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body}%
}
\setbeamertemplate{block end}
{\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block alerted begin}
{
  \setbeamercolor{item}{parent=block body alerted}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title alerted}
    \usebeamerfont*{block title alerted}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body alerted}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body alerted}%
}
\setbeamertemplate{block alerted end}
{\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block example begin}
{
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title example}
    \usebeamerfont*{block title example}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body example}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body example}%
}
\setbeamertemplate{block example end}
{\end{beamercolorbox}\vskip\smallskipamount}

%---------------------------------------------------------------------
% Images
%---------------------------------------------------------------------

\newbox\mytempbox
\newdimen\mytempdimen

\newcommand\includegraphicscopyright[3][]{%
  \leavevmode\vbox{\vskip3pt\raggedright\setbox\mytempbox=\hbox{\includegraphics[#1]{#2}}%
    \mytempdimen=\wd\mytempbox\box\mytempbox\par\vskip1pt%
    \usebeamerfont{copyright text}{\usebeamercolor[fg]{copyright text}{\vbox{\hsize=\mytempdimen#3}}}\vskip3pt%
}}

%---------------------------------------------------------------------
% Fonts
%---------------------------------------------------------------------

% \usepackage{fontspec}
% \defaultfontfeatures{Ligatures=TeX}
% \setmainfont[
%     BoldFont={Adobe Heiti Std},
%     ItalicFont={Adobe Kaiti Std}]{Adobe Song Std}
% \setsansfont{Adobe Kaiti Std}
% \setmonofont{Adobe Fangsong Std}

\usepackage{luatexja-fontspec}
% 英文字体
\setmainfont[Ligatures={Common,TeX}]{Tex Gyre Termes}
\setsansfont[Ligatures={Common,TeX}]{Droid Sans}
\setmonofont{CMU Typewriter Text}
\defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
% 中文字体
\setmainjfont[
 BoldFont={AdobeHeitiStd-Regular},
 ItalicFont={AdobeKaitiStd-Regular}]{AdobeSongStd-Light}
\setsansjfont{AdobeKaitiStd-Regular}
\defaultjfontfeatures{JFM=kaiming}

\newcommand\ziju[2]{\vbox{\ltjsetparameter{kanjiskip=#1} #2}}
\newjfontfamily\HEI{AdobeHeitiStd-Regular}
\newjfontfamily\KAI{AdobeKaitiStd-Regular}
\newjfontfamily\FANGSONG{AdobeFangsongStd-Regular}
\newcommand{\hei}[1]{{\jfontspec{AdobeHeitiStd-Regular} #1}}
\newcommand{\kai}[1]{{\jfontspec{AdobeKaitiStd-Regular} #1}}
\newcommand{\fangsong}[1]{{\jfontspec{AdobeFangsongStd-Regular} #1}}

%-------------------------------------------------------------------------------
%                Configuration for colors
%-------------------------------------------------------------------------------
% Gray-scale colors
\definecolor{white}{HTML}{FFFFFF}
\definecolor{black}{HTML}{000000}
\definecolor{darkgray}{HTML}{333333}
\definecolor{gray}{HTML}{5D5D5D}
\definecolor{lightgray}{HTML}{999999}
% Basic colors
\definecolor{green}{HTML}{C2E15F}
\definecolor{orange}{HTML}{FDA333}
\definecolor{purple}{HTML}{D3A4F9}
\definecolor{red}{HTML}{FB4485}
\definecolor{blue}{HTML}{6CE0F1}
% Text colors
\definecolor{darktext}{HTML}{414141}
\colorlet{text}{darkgray}
\definecolor{graytext}{HTML}{5D5D5D}
\colorlet{lighttext}{lightgray}
% Awesome colors
\definecolor{awesome-emerald}{HTML}{00A388}
\definecolor{awesome-skyblue}{HTML}{0395DE}
\definecolor{awesome-red}{HTML}{DC3522}
\definecolor{awesome-pink}{HTML}{EF4089}
\definecolor{awesome-orange}{HTML}{FF6138}
\definecolor{awesome-nephritis}{HTML}{27AE60}
\definecolor{awesome-concrete}{HTML}{95A5A6}
\definecolor{awesome-darknight}{HTML}{131A28}
\colorlet{awesome}{awesome-red}
% For elements of entry
\newcommand*{\entrytitlestyle}[1]{{\fontsize{12pt}{1em}\KAI\color{darktext} #1}}
\newcommand*{\entrypositionstyle}[1]{{\fontsize{12pt}{1em}\KAI\color{darktext} #1}}
\newcommand*{\entrydatestyle}[1]{{\fontsize{12pt}{1em}\KAI\color{darktext} #1}}
\newcommand*{\entrylocationstyle}[1]{{\fontsize{12pt}{1em}\KAI\color{awesome} #1}}
\newcommand*{\descriptionstyle}[1]{{\fontsize{10pt}{1em}\KAI\color{text} #1}}

% For elements of subentry
\newcommand*{\subentrytitlestyle}[1]{{\fontsize{12pt}{1em}\KAI\slshape\color{darktext} #1}}
% \newcommand*{\subentrytitlestyle}[1]{{\fontsize{9pt}{1em}\KAI\bdseries\color{graytext} #1}}
\newcommand*{\subentrypositionstyle}[1]{{\fontsize{12pt}{1em}\KAI\scshape\color{graytext} #1}}
\newcommand*{\subentrydatestyle}[1]{{\fontsize{12pt}{1em}\itshape\color{graytext} #1}}
\newcommand*{\subentrylocationstyle}[1]{{\fontsize{12pt}{1em}\KAI\upshape\color{awesome} #1}}
\newcommand*{\subdescriptionstyle}[1]{{\fontsize{10pt}{1em}\KAI\itshape\color{text} #1}}

% For elements of honor
\newcommand*{\honortitlestyle}[1]{{\fontsize{10pt}{1em}\KAI\itshape\color{graytext} #1}}
\newcommand*{\honorpositionstyle}[1]{{\fontsize{10pt}{1em}\HEI\bfseries\color{darktext} #1}}
\newcommand*{\honordatestyle}[1]{{\fontsize{10pt}{1em}\KAI\color{graytext} #1}}
\newcommand*{\honorlocationstyle}[1]{{\fontsize{10pt}{1em}\KAI\upshape\color{darktext} #1}}

% For elements of skill
\newcommand*{\skilltypestyle}[1]{{\fontsize{10pt}{1em}\bfseries\color{darktext} #1}}
\newcommand*{\skillsetstyle}[1]{{\fontsize{10pt}{1em}\color{text} #1}}

% Define an entry of cv Education
% Usage: \cveducation{<title>}{<location>}
\newcommand*{\cveducation}[2]{%
  \vspace{-2.0mm}
%   \setlength\tabcolsep{0pt}
%   \setlength{\extrarowheight}{0pt}
  \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lr}
    \entrytitlestyle{#1} & \entrylocationstyle{#2} \\
  \end{tabular*}%
}

\newcommand*{\cvsubeducation}[2]{%
  \vspace{-2.0mm}
%   \setlength\tabcolsep{0pt}
%   \setlength{\extrarowheight}{0pt}
  \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lr}
    \subentrytitlestyle{#1} & \subentrydatestyle{#2} \\
  \end{tabular*}%
}

% Define an entry of cv experience
% Usage: \cvexperience{<title>}{<date>}{<description>}
\newcommand*{\cvexperience}[2]{%
  \vspace{-2.0mm}
%   \setlength\tabcolsep{0pt}
%   \setlength{\extrarowheight}{0pt}
  \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lr}
    \entrytitlestyle{#1} & \subentrydatestyle{#2} \\
  \end{tabular*}%
}


% Define an environment for cvhonor
\newenvironment{cvhonors}{%
  \begin{center}
    % \setlength\tabcolsep{0pt}
    % \setlength{\extrarowheight}{0pt}
    \begin{tabular*}{\textwidth}{cl@{\extracolsep{\fill}}r}
}{%
    \end{tabular*}
  \end{center}
}


% Define a line of cv information(honor, award or something else)
% Usage: \cvhonor{<position>}{<title>}{<location>}{<date>}
\newcommand*{\cvhonor}[4]{%
  \vspace{1.0mm}
  \honordatestyle{#4} & \honorpositionstyle{#1}, \honortitlestyle{#2} & \honorlocationstyle{#3} \\
}

% Define an environment for cvskill
\newenvironment{cvskills}{%
  \begin{center}
    % \setlength\tabcolsep{1ex}
    % \setlength{\extrarowheight}{0pt}
    \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}rl}
}{%
    \end{tabular*}
  \end{center}
}
% Define a line of cv information(skill)
% Usage: \cvskill{<type>}{<skillset>}
\newcommand*{\cvskill}[2]{%
	\skilltypestyle{#1} & \skillsetstyle{#2} \\
}

% Define an environment for cventry
\newenvironment{cventries}{%
  \begin{center}
}{%
  \end{center}
}

\newcommand*{\cvpapers}[1]{%
  \vspace{-3.0mm}
  \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lr}
    \multicolumn{2}{L{\textwidth}}{\descriptionstyle{#1}}
  \end{tabular*}%
}

\mode
<all>
